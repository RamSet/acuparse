# Acuparse Troubleshooting Guide

## Logs

### Syslog

The best way to troubleshoot your installation is to view the syslog. All Acuparse output is logged there.

```bash
tail -f /var/log/syslog
```

### Apache

#### Access Log

The Apache access log contains all the data Apache has received from the web. Including the readings from your Access/Hub.
Checking this log will indicate if Acuparse is receiving data from your devices.

```bash
tail -f /var/log/apache2/access.log
```

#### Error Log

The Apache error log contains the errors and warnings generated by Apache and PHP.
Viewing this log can indicate if something is wrong with Acuparse.

```bash
tail -f /var/log/apache2/error.log
```

#### Cron Log

You can check for errors running cron jobs in the cron log file.

```bash
tail -f /opt/acuparse/logs/cron.log
```

## Sensor ID's and MAC Addresses

Without a MAC configured for your Hub or Access, Acuparse has no way of knowing what data it should listen for. You must
set a MAC and Iris (5-in-1) or Atlas (7-in-1) sensor ID in the admin settings to begin receiving and uploading your readings.

Sensor ID's/MAC addresses are located on the sensors themselves. If you can't locate them, the syslog will report all
sensors and MAC addresses it does not recognize.

You can search the syslog for the unknown messages.

```bash
cat /var/log/syslog | grep "Unknown"
```

## Cron Job

The cron job is essential for the proper operation of Acuparse. It runs the archiving, update checking, and external uploads.
If your station remains offline and/or there are no updates to external providers, there is a chance this is why.

Run the following commands to update your crontab.

```bash
crontab -l | { cat; echo "* * * * * php /opt/acuparse/cron/cron.php > /opt/acuparse/logs/cron.log 2>&1"; } | crontab -
```

To check for Cron errors, see [Cron Logs](#cron-log) above.

## Rasberry Pi's

When you are directly connecting your Access/Hub to a Rasberry Pi, you must change your upload servers to the secondary
ones. This is due to the fact that the Pi is redirecting your DNS locally and without changing the upload server, you can
end up with a never ending cycle of readings.

See [MyAcuRite Upload URL's](https://docs.acuparse.com/DNS/#myacurite-upload-urls) for more details!

## Installation Errors

If you experience unexpected results while completing the web install, try removing your config file and retry.

```bash
sudo rm /opt/acuparse/src/usr/config.php
```

In more extreme cases, you may also need to remove and [reinitialize the Acuparse database](https://docs.acuparse.com/INSTALL/#setup-database).

## Access Device

If your not receiving data from your Access, ensure you have a DNS resolvable hostname set for the upload server and/or
a DNS redirect in place. Then, reboot your Access. The Access can at times require multiple reboots to begin sending data.

### MyAcuRite Offline

If MyAcuRite is offline, Acuparse will respond to your Accesss and store your readings but they will not be back filled
to MyAcuRite after their outage is over. The Access is capable of storing the data and sending it later but when used
with Acuparse, the Access will continue to think MyAcuRite was online and the readings stored.

You will receive a warning in your `syslog` when this happens.

### NTP

The date and time are critical to Acuparse operations. Both on the server and on your Access device.

The Access device will check for NTP on `pool.ntp.org`. Ensure your Access can connect to NTP here, or redirect your DNS
for `pool.ntp.org` to a local NTP server.

If the installer was not able to configure NTP for you, review your OS documentation for the proper way to configure NTP
on your system.

### Hardcoded DNS Servers

The Access device appears to be configured to resolve DNS through `8.8.8.8` by default. This is becoming more and more
popular with IoT device makers, to prevent local filtering and also to ease technical support costs.
Currently, testing has shown that the Access will query your local DNS for a while, but for currently unknown reasons,
can switch and lock onto `8.8.8.8`. Connecting to the Access TTY output confirms this hardcode on boot.

There is a great article on how to resolve this [Your Smart TV is probably ignoring your PiHole](https://labzilla.io/blog/force-dns-pihole)
and some great discussion on this article, hardcoding, and DoH over at [Hacker News](https://news.ycombinator.com/item?id=25313776).

To resolve, you need to redirect DNS requests from your Access destined for `8.8.8.8` to your local DNS server
using your local firewall rules.

If your Acuparse install is **NOT** local, that is, installed in the cloud, you should ensure your Acuparse hostname\FQDN
is publicly resolvable through `8.8.8.8`.

### Cisco Switches

If your Access constantly reboots/reconnects when connected to a Cisco switch, enable Portfast.

```text
config terminal
interface FastEthernet0/XX
spanning-tree portfast
end
```

## Hub Device

### MyAcuRite Support

MyAcuRite has terminated support for the SmartHUB. Acuparse will receive and store these readings and respond to your hub.
Readings will not be uploaded to MyAcuRite and will only be stored locally. You can still use the Hub to upload to external
providers.

## Inaccurate Readings

There are times when the sensors report inaccurate readings. You can clean them from your archive table using MySQL.

Modify the query below to fit your requirements.

Main:

```bash
mysql -u<USER> -p<PASSWORD> -e "use acuparse; DELETE FROM `archive` WHERE `tempF`='-40' AND (`relH`='0' OR `relH`='1');
```

Towers:

```bash
mysql -u<USER> -p<PASSWORD> -e "use acuparse; DELETE FROM `tower_data` WHERE `sensor`='<SENSOR_ID>' AND `tempF`='-40' AND (`relH`='0' OR `relH`='1');
```
